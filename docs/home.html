import React, { useState, useEffect, useRef } from 'react';
import { Download, Wand2, Settings, Share2, Link as LinkIcon, Check, X, QrCode, Star, HelpCircle, ChevronDown, Users,
Image as ImageIcon, Upload, RefreshCw, Layout, Type } from 'lucide-react';

export default function App() {
const [url, setUrl] = useState('https://www.google.com');
const [qrUrl, setQrUrl] = useState('');
const [loading, setLoading] = useState(false);
const [isModalOpen, setIsModalOpen] = useState(false);

// Customization State
const [fgColor, setFgColor] = useState('#000000');
const [bgColor, setBgColor] = useState('#ffffff');
const [size, setSize] = useState(300);
const [margin, setMargin] = useState(10);
const [ecc, setEcc] = useState('M'); // L, M, Q, H
const [logo, setLogo] = useState(null); // Logo image data URL

// Refs for scrolling
const featuresRef = useRef(null);
const testimonialsRef = useRef(null);
const faqRef = useRef(null);
const fileInputRef = useRef(null);

const scrollToSection = (ref) => {
ref.current?.scrollIntoView({ behavior: 'smooth' });
};

// Generate QR URL based on state
useEffect(() => {
const generateQR = () => {
if (!url) return;
setLoading(true);

// Clean color codes (remove #)
const cleanFg = fgColor.replace('#', '');
const cleanBg = bgColor.replace('#', '');

// Using QRServer API
// Added ECC (Error Correction Code) support
const apiEndpoint =
`https://api.qrserver.com/v1/create-qr-code/?size=${size}x${size}&data=${encodeURIComponent(url)}&color=${cleanFg}&bgcolor=${cleanBg}&margin=${margin}&ecc=${ecc}`;

// Preload image to handle loading state
const img = new Image();
img.src = apiEndpoint;
img.onload = () => {
setQrUrl(apiEndpoint);
setLoading(false);
};
};

// Debounce generation slightly to avoid flickering while typing
const timer = setTimeout(generateQR, 500);
return () => clearTimeout(timer);
}, [url, fgColor, bgColor, size, margin, ecc]);

const handleDownload = async () => {
try {
setLoading(true);
// Create a canvas to merge QR and Logo if logo exists
const canvas = document.createElement('canvas');
const ctx = canvas.getContext('2d');
const img = new Image();
img.crossOrigin = "Anonymous";
img.src = qrUrl;

await new Promise((resolve) => {
img.onload = () => {
canvas.width = img.width;
canvas.height = img.height;
ctx.drawImage(img, 0, 0);

if (logo) {
const logoImg = new Image();
logoImg.src = logo;
logoImg.onload = () => {
// Draw logo in center (20% of QR size)
const logoSize = img.width * 0.2;
const logoX = (img.width - logoSize) / 2;
const logoY = (img.height - logoSize) / 2;

// Draw white background for logo
ctx.fillStyle = bgColor;
ctx.fillRect(logoX - 2, logoY - 2, logoSize + 4, logoSize + 4);

ctx.drawImage(logoImg, logoX, logoY, logoSize, logoSize);
resolve();
};
} else {
resolve();
}
};
});

const dataUrl = canvas.toDataURL('image/png');
const a = document.createElement('a');
a.href = dataUrl;
a.download = `qrcode-${Date.now()}.png`;
document.body.appendChild(a);
a.click();
document.body.removeChild(a);
} catch (error) {
console.error('Download failed:', error);
alert('下载出错，将为您在新窗口打开图片。');
window.open(qrUrl, '_blank');
} finally {
setLoading(false);
}
};

const handleLogoUpload = (event) => {
const file = event.target.files[0];
if (file) {
const reader = new FileReader();
reader.onload = (e) => {
setLogo(e.target.result);
};
reader.readAsDataURL(file);
}
};

// Testimonials Data
const testimonials = [
{
name: "张伟",
role: "市场营销经理",
content: "这是我用过最简单、最快速的二维码生成工具。自定义颜色功能让我们的营销材料看起来更专业。",
avatar: "https://i.pravatar.cc/150?u=zhangwei"
},
{
name: "李娜",
role: "独立设计师",
content: "作为设计师，我对细节要求很高。这个工具生成的高清PNG完全满足了我的印刷需求，强烈推荐！",
avatar: "https://i.pravatar.cc/150?u=lina"
},
{
name: "王强",
role: "小型企业主",
content: "无需登录，免费使用，而且生成的二维码扫描速度很快。对于我们这样的小企业来说，简直太棒了。",
avatar: "https://i.pravatar.cc/150?u=wangqiang"
}
];

// FAQ Data
const faqs = [
{
question: "生成的二维码是永久有效的吗？",
answer: "是的，只要您输入的网址是有效的，生成的二维码就会一直有效。我们不会对二维码设置任何过期时间。"
},
{
question: "我可以将生成的二维码用于商业用途吗？",
answer: "当然可以。本工具生成的二维码完全免费，您可以将其用于任何个人或商业项目，无需注明出处。"
},
{
question: "你们会存储我的数据吗？",
answer: "不会。我们非常重视您的隐私。您输入的网址仅用于实时生成二维码，我们不会在服务器上存储任何信息。"
},
{
question: "如何提高二维码的扫描成功率？",
answer: "建议保持二维码的前景色和背景色有足够的对比度（例如黑白）。同时，避免将二维码做得太小或太复杂。"
}
];

// Accordion State for FAQ
const [openFaqIndex, setOpenFaqIndex] = useState(null);
const toggleFaq = (index) => {
setOpenFaqIndex(openFaqIndex === index ? null : index);
};

return (
<div className="min-h-screen bg-slate-50 text-slate-900 font-sans selection:bg-indigo-100 selection:text-indigo-700">

    {/* Navigation */}
    <nav className="fixed w-full z-50 bg-white/80 backdrop-blur-md border-b border-slate-200">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div className="flex justify-between h-16 items-center">
                <div className="flex items-center gap-2 cursor-pointer" onClick={()=> window.scrollTo({ top: 0,
                    behavior: 'smooth' })}>
                    <div className="bg-indigo-600 p-2 rounded-lg">
                        <QrCode className="w-6 h-6 text-white" />
                    </div>
                    <span className="font-bold text-xl tracking-tight text-slate-800">QR Master</span>
                </div>
                <div className="hidden md:flex items-center gap-6 text-sm font-medium text-slate-600">
                    <button onClick={()=> scrollToSection(featuresRef)} className="hover:text-indigo-600
                        transition-colors">产品功能</button>
                    <button onClick={()=> scrollToSection(testimonialsRef)} className="hover:text-indigo-600
                        transition-colors">用户评价</button>
                    <button onClick={()=> scrollToSection(faqRef)} className="hover:text-indigo-600
                        transition-colors">常见问题</button>
                </div>
                <button
                    className="text-sm font-semibold bg-slate-900 text-white px-4 py-2 rounded-full hover:bg-slate-800 transition-colors">
                    联系合作
                </button>
            </div>
        </div>
    </nav>

    {/* Hero Section */}
    <main className="pt-32 pb-16 lg:pt-48 lg:pb-32 px-4 sm:px-6 lg:px-8 max-w-7xl mx-auto">
        {/* ... (Hero content remains the same) */}
        <div className="grid lg:grid-cols-2 gap-12 lg:gap-24 items-center">

            {/* Left Column: Input & Text */}
            <div className="space-y-8 animate-fade-in-up">
                <div className="space-y-4">
                    <div
                        className="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-indigo-50 text-indigo-600 text-sm font-semibold border border-indigo-100">
                        <span className="relative flex h-2 w-2">
                            <span
                                className="animate-ping absolute inline-flex h-full w-full rounded-full bg-indigo-400 opacity-75"></span>
                            <span className="relative inline-flex rounded-full h-2 w-2 bg-indigo-500"></span>
                        </span>
                        完全免费 · 无需登录
                    </div>
                    <h1 className="text-4xl lg:text-6xl font-extrabold tracking-tight text-slate-900 leading-tight">
                        为您的链接生成 <br />
                        <span className="text-transparent bg-clip-text bg-gradient-to-r from-indigo-600 to-purple-600">
                            完美的二维码
                        </span>
                    </h1>
                    <p className="text-lg text-slate-600 max-w-xl leading-relaxed">
                        简单、快速、可定制。只需输入您的网址，即可生成高质量的二维码。适用于营销活动、个人名片或任何分享场景。
                    </p>
                </div>

                <div
                    className="bg-white p-2 rounded-2xl shadow-xl shadow-indigo-100 border border-slate-200 flex flex-col sm:flex-row gap-2">
                    <div className="relative flex-grow">
                        <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <LinkIcon className="h-5 w-5 text-slate-400" />
                        </div>
                        <input type="text"
                            className="block w-full pl-10 pr-3 py-4 text-slate-900 placeholder-slate-400 focus:outline-none focus:ring-0 bg-transparent text-lg"
                            placeholder="请输入您的网址 (例如: https://example.com)" value={url} onChange={(e)=>
                        setUrl(e.target.value)}
                        />
                    </div>
                    <button onClick={()=> {}} // Already reactive via useEffect
                        className="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-8 rounded-xl
                        transition-all duration-200 shadow-lg shadow-indigo-200 transform hover:-translate-y-0.5"
                        >
                        生成
                    </button>
                </div>

                <div className="flex items-center gap-6 text-sm text-slate-500">
                    <div className="flex items-center gap-2">
                        <Check className="w-4 h-4 text-green-500" />
                        <span>永久有效</span>
                    </div>
                    <div className="flex items-center gap-2">
                        <Check className="w-4 h-4 text-green-500" />
                        <span>高清下载</span>
                    </div>
                    <div className="flex items-center gap-2">
                        <Check className="w-4 h-4 text-green-500" />
                        <span>支持个性化</span>
                    </div>
                </div>
            </div>

            {/* Right Column: QR Preview Card */}
            <div className="relative lg:h-[500px] flex items-center justify-center">
                {/* Background Decor */}
                <div
                    className="absolute inset-0 bg-gradient-to-tr from-indigo-50 to-purple-50 rounded-3xl transform rotate-3 scale-95 opacity-70">
                </div>
                <div
                    className="absolute inset-0 bg-gradient-to-bl from-blue-50 to-indigo-50 rounded-3xl transform -rotate-2 scale-95 opacity-70">
                </div>

                {/* Main Card */}
                <div
                    className="relative bg-white rounded-2xl shadow-2xl shadow-slate-200/50 p-8 w-full max-w-sm border border-slate-100 backdrop-blur-sm transition-all duration-500">
                    <div
                        className="aspect-square bg-slate-50 rounded-xl overflow-hidden border border-slate-100 flex items-center justify-center relative group bg-white">
                        {loading && (
                        <div
                            className="absolute inset-0 flex items-center justify-center bg-white/80 z-10 backdrop-blur-sm">
                            <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"></div>
                        </div>
                        )}
                        {qrUrl ? (
                        <div className="relative w-full h-full p-4 flex items-center justify-center">
                            <img src={qrUrl} alt="QR Code" className="w-full h-full object-contain" />
                            {logo && (
                            <div className="absolute inset-0 flex items-center justify-center">
                                <div className="bg-white p-1 rounded-md shadow-sm">
                                    <img src={logo} alt="Logo" className="w-12 h-12 object-contain" />
                                </div>
                            </div>
                            )}
                        </div>
                        ) : (
                        <div className="text-slate-400 text-center p-4">
                            <QrCode className="w-12 h-12 mx-auto mb-2 opacity-20" />
                            <span className="text-sm">输入网址以生成</span>
                        </div>
                        )}
                    </div>

                    <div className="mt-8 grid grid-cols-2 gap-4">
                        <button onClick={handleDownload} disabled={!url || loading}
                            className="flex items-center justify-center gap-2 bg-slate-900 text-white py-3 px-4 rounded-xl hover:bg-slate-800 disabled:opacity-50 disabled:cursor-not-allowed transition-all font-medium active:scale-95">
                            <Download className="w-4 h-4" />
                            下载 PNG
                        </button>
                        <button onClick={()=> setIsModalOpen(true)}
                            disabled={!url}
                            className="flex items-center justify-center gap-2 bg-white text-slate-700 border
                            border-slate-200 py-3 px-4 rounded-xl hover:bg-slate-50 hover:border-slate-300
                            disabled:opacity-50 disabled:cursor-not-allowed transition-all font-medium active:scale-95"
                            >
                            <Wand2 className="w-4 h-4 text-indigo-500" />
                            美化二维码
                        </button>
                    </div>
                </div>
            </div>

        </div>
    </main>

    {/* Feature Grid, Testimonials, FAQ Sections... (Keep as is, hidden for brevity in logic but rendered in full file)
    */}
    {/* Feature Grid (Product Features) */}
    <section ref={featuresRef} className="bg-white py-24 border-t border-slate-100 scroll-mt-16">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div className="text-center mb-16">
                <span className="text-indigo-600 font-semibold text-sm uppercase tracking-wider">核心优势</span>
                <h2 className="text-3xl font-bold text-slate-900 mt-2">为什么选择 QR Master？</h2>
                <p className="mt-4 text-slate-600 text-lg max-w-2xl mx-auto">不仅仅是生成，我们提供更优质、更专业的二维码解决方案。</p>
            </div>
            <div className="grid md:grid-cols-3 gap-8">
                {[
                { icon:
                <Settings className="w-6 h-6 text-indigo-600" />, title: "高度可定制", desc:
                "自定义颜色、边距和尺寸，让二维码完美融入您的品牌设计风格，提升品牌形象。" },
                { icon:
                <Download className="w-6 h-6 text-indigo-600" />, title: "高清导出", desc: "支持高清 PNG
                格式下载，像素完美，满足从网络展示到大幅面印刷的各种需求。" },
                { icon:
                <Share2 className="w-6 h-6 text-indigo-600" />, title: "跨平台兼容", desc:
                "生成的二维码经过优化，可在所有主流智能手机和扫描应用中快速、准确地识别。" },
                { icon:
                <Check className="w-6 h-6 text-indigo-600" />, title: "永久有效", desc:
                "生成的静态二维码不依赖于我们的服务器，只要您的链接有效，二维码就永久有效。" },
                { icon:
                <Users className="w-6 h-6 text-indigo-600" />, title: "无需注册", desc: "告别繁琐的注册流程，打开页面即可使用，保护您的隐私，提高工作效率。"
                },
                { icon:
                <Wand2 className="w-6 h-6 text-indigo-600" />, title: "实时预览", desc: "所见即所得。在您调整设置时，二维码会实时更新，确保您获得满意的结果。"
                },
                ].map((feature, idx) => (
                <div key={idx}
                    className="p-8 bg-slate-50 rounded-3xl border border-slate-100 hover:shadow-xl hover:-translate-y-1 transition-all duration-300">
                    <div className="w-14 h-14 bg-indigo-100 rounded-2xl flex items-center justify-center mb-6">
                        {feature.icon}
                    </div>
                    <h3 className="text-xl font-bold text-slate-900 mb-3">{feature.title}</h3>
                    <p className="text-slate-600 leading-relaxed">{feature.desc}</p>
                </div>
                ))}
            </div>
        </div>
    </section>

    {/* Testimonials Section */}
    <section ref={testimonialsRef} className="bg-slate-50 py-24 border-t border-slate-200 scroll-mt-16">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div className="text-center mb-16">
                <span className="text-indigo-600 font-semibold text-sm uppercase tracking-wider">用户评价</span>
                <h2 className="text-3xl font-bold text-slate-900 mt-2">深受用户信赖</h2>
                <p className="mt-4 text-slate-600 text-lg max-w-2xl mx-auto">听听来自不同行业的用户如何评价 QR Master。</p>
            </div>
            <div className="grid md:grid-cols-3 gap-8">
                {testimonials.map((testimonial, idx) => (
                <div key={idx} className="bg-white p-8 rounded-3xl shadow-sm border border-slate-100 relative">
                    <div className="flex items-center gap-1 text-yellow-400 mb-6">
                        {[...Array(5)].map((_, i) =>
                        <Star key={i} className="w-5 h-5 fill-current" />)}
                    </div>
                    <p className="text-slate-700 text-lg leading-relaxed mb-8">"{testimonial.content}"</p>
                    <div className="flex items-center gap-4">
                        <img src={testimonial.avatar} alt={testimonial.name}
                            className="w-12 h-12 rounded-full bg-slate-200" />
                        <div>
                            <h4 className="font-bold text-slate-900">{testimonial.name}</h4>
                            <p className="text-sm text-slate-500">{testimonial.role}</p>
                        </div>
                    </div>
                </div>
                ))}
            </div>
        </div>
    </section>

    {/* FAQ Section */}
    <section ref={faqRef} className="bg-white py-24 border-t border-slate-100 scroll-mt-16">
        <div className="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8">
            <div className="text-center mb-16">
                <span className="text-indigo-600 font-semibold text-sm uppercase tracking-wider">常见问题</span>
                <h2 className="text-3xl font-bold text-slate-900 mt-2">解答您的疑问</h2>
                <p className="mt-4 text-slate-600 text-lg">如果您还有其他问题，欢迎随时联系我们。</p>
            </div>
            <div className="space-y-4">
                {faqs.map((faq, idx) => (
                <div key={idx}
                    className="border border-slate-200 rounded-2xl overflow-hidden transition-all duration-200 hover:border-indigo-200 bg-slate-50">
                    <button onClick={()=> toggleFaq(idx)}
                        className="flex justify-between items-center w-full p-6 text-left focus:outline-none"
                        >
                        <h3 className="text-lg font-semibold text-slate-900 flex items-center gap-3">
                            <HelpCircle className="w-5 h-5 text-indigo-500 flex-shrink-0" />
                            {faq.question}
                        </h3>
                        <ChevronDown className={`w-5 h-5 text-slate-500 transition-transform duration-300
                            ${openFaqIndex===idx ? 'rotate-180' : '' }`} />
                    </button>
                    <div className={`overflow-hidden transition-all duration-300 ${openFaqIndex===idx
                        ? 'max-h-48 opacity-100' : 'max-h-0 opacity-0' }`}>
                        <p className="p-6 pt-0 text-slate-600 leading-relaxed border-t border-slate-100 bg-white">
                            {faq.answer}
                        </p>
                    </div>
                </div>
                ))}
            </div>
        </div>
    </section>

    {/* NEW Full-Screen Beautify Modal / Editor */}
    {isModalOpen && (
    <div className="fixed inset-0 z-[100] flex flex-col bg-white animate-in fade-in duration-200">

        {/* Editor Header */}
        <div className="h-16 border-b border-slate-200 flex items-center justify-between px-6 bg-white flex-shrink-0">
            <h2 className="text-lg font-bold text-slate-800 flex items-center gap-2">
                <Wand2 className="w-5 h-5 text-indigo-600" />
                二维码样式编辑器
            </h2>
            <div className="flex items-center gap-4">
                <button className="text-sm text-slate-500 hover:text-indigo-600 transition-colors">
                    另存为我的样式
                </button>
                <div className="w-px h-4 bg-slate-300"></div>
                <button onClick={()=> setIsModalOpen(false)}
                    className="p-2 hover:bg-slate-100 rounded-full text-slate-500 transition-colors"
                    >
                    <X className="w-6 h-6" />
                </button>
            </div>
        </div>

        <div className="flex-1 flex overflow-hidden">

            {/* LEFT SIDEBAR: Settings */}
            <div className="w-80 md:w-96 border-r border-slate-200 bg-white overflow-y-auto p-6 space-y-8">

                {/* Current Style */}
                <div className="space-y-3">
                    <div className="text-xs font-semibold text-slate-400 uppercase tracking-wider">当前样式</div>
                    <div
                        className="flex items-center justify-between bg-slate-50 p-3 rounded-lg border border-slate-100">
                        <span className="font-medium text-slate-700">基本样式</span>
                        <button
                            className="text-xs text-green-600 font-medium border border-green-600 px-2 py-1 rounded hover:bg-green-50 transition-colors">
                            更换样式
                        </button>
                    </div>
                </div>

                {/* Logo Section */}
                <div className="space-y-3">
                    <div className="text-sm font-bold text-slate-800">Logo</div>
                    <div className="flex gap-3">
                        <input type="file" ref={fileInputRef} className="hidden" accept="image/*"
                            onChange={handleLogoUpload} />
                        <button onClick={()=> fileInputRef.current.click()}
                            className="flex-1 py-2 px-3 border border-slate-300 rounded-md text-sm text-slate-600
                            hover:border-indigo-500 hover:text-indigo-600 transition-colors flex items-center
                            justify-center gap-2 bg-white"
                            >
                            <Upload className="w-4 h-4" />
                            上传Logo
                        </button>
                        <button onClick={()=> setLogo(null)}
                            className="flex-1 py-2 px-3 border border-slate-300 rounded-md text-sm text-slate-600
                            hover:border-red-500 hover:text-red-600 transition-colors flex items-center justify-center
                            gap-2 bg-white"
                            >
                            <X className="w-4 h-4" />
                            清除
                        </button>
                    </div>
                </div>

                {/* Code Settings */}
                <div className="space-y-4">
                    <div className="text-sm font-bold text-slate-800">码点码眼</div>

                    {/* Colors */}
                    <div className="grid grid-cols-2 gap-4">
                        <div className="space-y-1.5">
                            <label className="text-xs text-slate-500">码颜色</label>
                            <div
                                className="flex items-center gap-2 border border-slate-300 rounded-md p-1.5 focus-within:ring-2 focus-within:ring-indigo-500/20 focus-within:border-indigo-500 hover:border-slate-400 transition-colors bg-white">
                                <div className="w-6 h-6 rounded border border-slate-200 flex-shrink-0 overflow-hidden">
                                    <input type="color" value={fgColor} onChange={(e)=> setFgColor(e.target.value)}
                                    className="w-full h-full p-0 border-0 cursor-pointer scale-150" />
                                </div>
                                <span className="text-xs font-mono text-slate-600 flex-1">{fgColor}</span>
                            </div>
                        </div>
                        <div className="space-y-1.5">
                            <label className="text-xs text-slate-500">码背景色</label>
                            <div
                                className="flex items-center gap-2 border border-slate-300 rounded-md p-1.5 focus-within:ring-2 focus-within:ring-indigo-500/20 focus-within:border-indigo-500 hover:border-slate-400 transition-colors bg-white">
                                <div className="w-6 h-6 rounded border border-slate-200 flex-shrink-0 overflow-hidden">
                                    <input type="color" value={bgColor} onChange={(e)=> setBgColor(e.target.value)}
                                    className="w-full h-full p-0 border-0 cursor-pointer scale-150" />
                                </div>
                                <span className="text-xs font-mono text-slate-600 flex-1">{bgColor}</span>
                            </div>
                        </div>
                    </div>

                    {/* Shapes (UI Only for now as API limited) */}
                    <div className="grid grid-cols-2 gap-4">
                        <div className="space-y-1.5">
                            <label className="text-xs text-slate-500">码点形状</label>
                            <div className="relative">
                                <select
                                    className="w-full appearance-none bg-white border border-slate-300 text-slate-700 text-sm rounded-md py-2 px-3 pr-8 focus:outline-none focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500">
                                    <option>普通 (Square)</option>
                                    <option>圆点 (Dots)</option>
                                    <option>液态 (Liquid)</option>
                                </select>
                                <ChevronDown
                                    className="absolute right-2 top-2.5 w-4 h-4 text-slate-400 pointer-events-none" />
                            </div>
                        </div>
                        <div className="space-y-1.5">
                            <label className="text-xs text-slate-500">码眼形状</label>
                            <div className="relative">
                                <select
                                    className="w-full appearance-none bg-white border border-slate-300 text-slate-700 text-sm rounded-md py-2 px-3 pr-8 focus:outline-none focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500">
                                    <option>方正 (Square)</option>
                                    <option>圆角 (Rounded)</option>
                                    <option>叶子 (Leaf)</option>
                                </select>
                                <ChevronDown
                                    className="absolute right-2 top-2.5 w-4 h-4 text-slate-400 pointer-events-none" />
                            </div>
                        </div>
                    </div>

                </div>

                {/* More Settings */}
                <div className="space-y-4 pt-4 border-t border-slate-100">
                    <div className="text-sm font-bold text-slate-800">更多</div>

                    <div className="space-y-4">
                        <div className="flex items-center justify-between">
                            <label className="text-sm text-slate-600">码边距 (Margin)</label>
                            <select value={margin} onChange={(e)=> setMargin(Number(e.target.value))}
                                className="bg-slate-50 border border-slate-200 text-sm rounded px-2 py-1 text-slate-700
                                focus:outline-none focus:border-indigo-500"
                                >
                                {[0, 10, 20, 30, 40].map(m => (
                                <option key={m} value={m}>{m}px</option>
                                ))}
                            </select>
                        </div>

                        <div className="flex items-center justify-between">
                            <label className="text-sm text-slate-600">容错率 (ECC)</label>
                            <select value={ecc} onChange={(e)=> setEcc(e.target.value)}
                                className="bg-slate-50 border border-slate-200 text-sm rounded px-2 py-1 text-slate-700
                                focus:outline-none focus:border-indigo-500"
                                >
                                <option value="L">L (7%)</option>
                                <option value="M">M (15%)</option>
                                <option value="Q">Q (25%)</option>
                                <option value="H">H (30%)</option>
                            </select>
                        </div>

                        <div className="space-y-2">
                            <label className="text-sm text-slate-600">编码内容</label>
                            <input type="text" value={url} onChange={(e)=> setUrl(e.target.value)}
                            className="w-full border border-slate-300 rounded-md px-3 py-2 text-sm text-slate-600
                            focus:outline-none focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500 bg-slate-50"
                            />
                        </div>
                    </div>

                    <button
                        className="w-full mt-4 py-2 border border-dashed border-slate-300 rounded-md text-slate-500 hover:text-indigo-600 hover:border-indigo-400 hover:bg-indigo-50 transition-all flex items-center justify-center gap-2 text-sm font-medium">
                        <Type className="w-4 h-4" />
                        + 添加文字 (水印)
                    </button>
                </div>

            </div>

            {/* RIGHT MAIN: Preview Area */}
            <div className="flex-1 bg-slate-100 flex flex-col items-center justify-center p-8 relative overflow-hidden">
                {/* Pattern Background */}
                <div className="absolute inset-0 opacity-[0.03] pointer-events-none" style={{
                    backgroundImage: 'radial-gradient(#4f46e5 1px, transparent 1px)' , backgroundSize: '24px 24px' }}>
                </div>

                <div className="text-center mb-6">
                    <span className="text-sm text-slate-500">当前样式: <span
                            className="font-semibold text-slate-700">基本样式</span></span>
                    <button className="ml-2 text-xs text-indigo-600 hover:underline">更换样式</button>
                </div>

                {/* Preview Card */}
                <div
                    className="bg-white p-6 rounded-xl shadow-xl shadow-slate-200/50 mb-8 transition-all duration-300 transform hover:scale-[1.02]">
                    <div className="w-64 h-64 md:w-80 md:h-80 relative flex items-center justify-center bg-white">
                        {loading && (
                        <div
                            className="absolute inset-0 z-10 bg-white/90 flex items-center justify-center backdrop-blur-[1px]">
                            <div
                                className="animate-spin rounded-full h-8 w-8 border-2 border-slate-200 border-t-indigo-600">
                            </div>
                        </div>
                        )}
                        <img src={qrUrl} alt="Preview" className="w-full h-full object-contain" />
                        {/* Logo Overlay */}
                        {logo && (
                        <div className="absolute inset-0 flex items-center justify-center pointer-events-none">
                            <div className="bg-white p-1.5 rounded-lg shadow-sm">
                                <img src={logo} alt="Logo Overlay"
                                    className="w-12 h-12 md:w-16 md:h-16 object-contain" />
                            </div>
                        </div>
                        )}
                    </div>
                </div>

                {/* Action Buttons */}
                <div className="flex flex-col items-center gap-4">
                    <button onClick={()=> setIsModalOpen(false)}
                        className="bg-green-600 hover:bg-green-700 text-white font-medium py-2.5 px-12 rounded-lg
                        shadow-lg shadow-green-600/20 transition-all active:scale-95"
                        >
                        保存样式并返回
                    </button>

                    <div className="flex items-center gap-6 text-sm text-slate-500">
                        <button onClick={()=> { setLogo(null); setFgColor('#000000'); setBgColor('#ffffff');
                            setMargin(10); setEcc('M'); }} className="hover:text-slate-800 transition-colors flex
                            items-center gap-1">
                            <RefreshCw className="w-3 h-3" /> 清除样式
                        </button>
                        <div className="w-px h-3 bg-slate-300"></div>
                        <button onClick={handleDownload}
                            className="hover:text-indigo-600 transition-colors font-medium">
                            下载打印
                        </button>
                    </div>
                </div>

            </div>
        </div>

    </div>
    )}

    {/* Footer */}
    <footer className="bg-slate-900 text-white py-16">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 grid grid-cols-1 md:grid-cols-4 gap-12">
            <div className="space-y-4 col-span-1 md:col-span-2">
                <div className="flex items-center gap-2">
                    <div className="bg-indigo-600 p-2 rounded-lg">
                        <QrCode className="w-6 h-6 text-white" />
                    </div>
                    <span className="font-bold text-xl tracking-tight">QR Master</span>
                </div>
                <p className="text-slate-400 text-sm leading-relaxed max-w-sm">
                    为您提供简单、快速、专业的二维码生成服务。无需登录，即刻使用。
                </p>
            </div>
            <div>
                <h3 className="font-semibold text-lg mb-4">快速链接</h3>
                <ul className="space-y-2 text-sm text-slate-400">
                    <li><button onClick={()=> window.scrollTo({ top: 0, behavior: 'smooth' })}
                            className="hover:text-white transition-colors">首页</button></li>
                    <li><button onClick={()=> scrollToSection(featuresRef)} className="hover:text-white
                            transition-colors">产品功能</button></li>
                    <li><button onClick={()=> scrollToSection(testimonialsRef)} className="hover:text-white
                            transition-colors">用户评价</button></li>
                    <li><button onClick={()=> scrollToSection(faqRef)} className="hover:text-white
                            transition-colors">常见问题</button></li>
                </ul>
            </div>
            <div>
                <h3 className="font-semibold text-lg mb-4">联系我们</h3>
                <ul className="space-y-2 text-sm text-slate-400">
                    <li><a href="mailto:support@qrmaster.com"
                            className="hover:text-white transition-colors">support@qrmaster.com</a></li>
                    <li><a href="#" className="hover:text-white transition-colors">Twitter</a></li>
                    <li><a href="#" className="hover:text-white transition-colors">GitHub</a></li>
                </ul>
            </div>
        </div>
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-12 pt-8 border-t border-slate-800 text-center">
            <p className="text-slate-500 text-sm">© {new Date().getFullYear()} QR Master. All rights reserved.</p>
        </div>
    </footer>

</div>
);
}